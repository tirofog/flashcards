<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSV to PDF with Fixed Table</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    input, button, label, textarea {
      display: block;
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      box-sizing: border-box;
    }
    textarea {
      height: 150px;
      resize: vertical;
    }
    button {
      background-color: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>CSV to PDF</h1>

    <label for="csvFile">Upload your CSV file:</label>
    <input type="file" id="csvFile" accept=".csv">

    <label for="csvText">Or paste your CSV content here:</label>
    <textarea id="csvText" placeholder="e.g., een baviaan,a baboon\neen jachtluipaard,a cheetah\neen chimpansee,a chimpanzee\neen hert,a deer"></textarea>

    <button id="generatePdf">Convert to PDF</button>
  </div>

  <script>
    document.getElementById('generatePdf').addEventListener('click', () => {
      const fileInput = document.getElementById('csvFile');
      const csvText = document.getElementById('csvText').value.trim();

      if (!fileInput.files.length && !csvText) {
        alert('Please upload a CSV file or paste CSV content.');
        return;
      }

      if (fileInput.files.length) {
        const file = fileInput.files[0];
        Papa.parse(file, {
          complete: (results) => {
            const data = results.data;
            if (!validateCsvData(data)) return;
            generatePDF(data);
          },
          error: () => alert('Error reading CSV file.')
        });
      } else if (csvText) {
        const data = Papa.parse(csvText, { delimiter: ',', skipEmptyLines: true }).data;
        if (!validateCsvData(data)) return;
        generatePDF(data);
      }
    });

    function validateCsvData(data) {
      if (data.length < 2 || data[0].length !== 2) {
        alert('The CSV data must have exactly two columns.');
        return false;
      }
      return true;
    }

    function generatePDF(data) {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();

      // Prepare table data
      const tableData = [];
      for (let i = 0; i < data.length; i += 2) {
        tableData.push([
          data[i]?.[0] || "",       // 1st column of 1st CSV row
          data[i]?.[1] || "",       // 2nd column of 1st CSV row
          data[i + 1]?.[0] || "",   // 1st column of 2nd CSV row
          data[i + 1]?.[1] || ""    // 2nd column of 2nd CSV row
        ]);
      }

      // Generate the table using autoTable
      pdf.autoTable({
        body: tableData, // Table data
        startY: 20,
        theme: 'grid',
        styles: {
          halign: 'center',  // Center align text horizontally
          valign: 'middle',  // Center align text vertically
          fontSize: 10,
          cellPadding: 3,
          overflow: 'linebreak' // Enable text wrapping
        },
        columnStyles: {
          0: { cellWidth: 45 }, // Fixed width for Column 1
          1: { cellWidth: 45 }, // Fixed width for Column 2
          2: { cellWidth: 45 }, // Fixed width for Column 3
          3: { cellWidth: 45 }, // Fixed width for Column 4
        },
        bodyStyles: {
          minCellHeight: 20 // Fixed row height (prevents dynamic resizing)
        },
        pageBreak: 'auto',

        // Cell start callback
        cellStart: function(data) {
          // Set the row height to the fixed value
          const fixedRowHeight = 20;
          if (data.row.index > 0) {
            const yPosition = data.cell.y;
            data.cell.height = fixedRowHeight;
            // Adjust Y position to maintain row alignment
            data.cell.y = yPosition + (fixedRowHeight - data.cell.height);
          }
        }
      });

      pdf.save('converted.pdf');
    }
  </script>
</body>
</html>
